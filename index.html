<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eFootball Arena - Live</title>
    <style>
        :root {
            --primary: #00ff88;
            --bg: #0b0e14;
            --card: #1a1f26;
            --text: #ffffff;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        h1 { text-align: center; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; }
        
        /* Tabela */
        table { width: 100%; border-collapse: collapse; background: var(--card); border-radius: 8px; overflow: hidden; margin-bottom: 30px; }
        th, td { padding: 15px; text-align: center; border-bottom: 1px solid #2d343e; }
        th { background: #252c36; color: var(--primary); }
        tr:hover { background: #252c36; }

        /* Confrontos */
        .match-card { background: var(--card); padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--primary); }
        .score-input { width: 40px; background: #0b0e14; border: 1px solid var(--primary); color: white; text-align: center; border-radius: 4px; padding: 5px; }
        
        button { background: var(--primary); border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { opacity: 0.8; transform: scale(1.05); }
        .admin-section { background: #252c36; padding: 20px; border-radius: 8px; margin-top: 40px; border: 1px dashed var(--primary); }
        .live-badge { background: red; padding: 2px 8px; border-radius: 4px; font-size: 10px; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <h1>üèÜ eFootball Arena <span class="live-badge">LIVE</span></h1>

    <section>
        <h3>Classifica√ß√£o Real-Time</h3>
        <table id="leaderboard">
            <thead>
                <tr>
                    <th>Pos</th>
                    <th>Jogador</th>
                    <th>Pts</th>
                    <th>V</th>
                    <th>E</th>
                    <th>D</th>
                    <th>SG</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </section>

    <section id="matches-section">
        <h3>Confrontos (Ida e Volta)</h3>
        <div id="matches-list">
            </div>
    </section>

    <div class="admin-section" id="admin-panel">
        <h3>Painel do Administrador</h3>
        <input type="text" id="new-player" placeholder="Nome do Jogador">
        <button onclick="addPlayer()">Adicionar Jogador</button>
        <button onclick="generateMatches()" style="background: #ffcc00;">Sortear Torneio</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDVSyYqthdpYZmtHtfljrlGs6p9r6MtL4U",
        authDomain: "efootball-league-f71ac.firebaseapp.com",
        projectId: "efootball-league-f71ac",
        storageBucket: "efootball-league-f71ac.firebasestorage.app",
        messagingSenderId: "887037026578",
        appId: "1:887037026578:web:8513b9dd71597ccca7d3cb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- FUN√á√ïES DE INTERFACE ---

    // 1. Ouvir Jogadores (Tempo Real)
    onSnapshot(query(collection(db, "jogadores"), orderBy("pts", "desc"), orderBy("sg", "desc")), (snapshot) => {
        const tbody = document.querySelector("#leaderboard tbody");
        tbody.innerHTML = "";
        snapshot.docs.forEach((doc, index) => {
            const p = doc.data();
            tbody.innerHTML += `
                <tr>
                    <td>${index + 1}¬∫</td>
                    <td>${p.nome}</td>
                    <td><strong>${p.pts}</strong></td>
                    <td>${p.v}</td>
                    <td>${p.e}</td>
                    <td>${p.d}</td>
                    <td>${p.sg}</td>
                </tr>
            `;
        });
    });

    // 2. Ouvir Partidas (Tempo Real)
    onSnapshot(collection(db, "partidas"), (snapshot) => {
        const list = document.getElementById("matches-list");
        list.innerHTML = "";
        snapshot.docs.forEach(docSnap => {
            const m = docSnap.data();
            list.innerHTML += `
                <div class="match-card">
                    <span>${m.p1}</span>
                    <div>
                        <input type="number" class="score-input" id="g1-${docSnap.id}" value="${m.g1}">
                        x
                        <input type="number" class="score-input" id="g2-${docSnap.id}" value="${m.g2}">
                        <button onclick="updateScore('${docSnap.id}', '${m.p1}', '${m.p2}')">üíæ</button>
                    </div>
                    <span>${m.p2}</span>
                </div>
            `;
        });
    });

    // --- FUN√á√ïES DE L√ìGICA (ADMIN) ---

    window.addPlayer = async () => {
        const nome = document.getElementById("new-player").value;
        if (!nome) return;
        await addDoc(collection(db, "jogadores"), {
            nome, pts: 0, v: 0, e: 0, d: 0, sg: 0
        });
        document.getElementById("new-player").value = "";
    };

    window.generateMatches = async () => {
        const snap = await getDocs(collection(db, "jogadores"));
        const players = snap.docs.map(d => d.data().nome);
        
        // Sorteio Simples Ida e Volta
        for (let i = 0; i < players.length; i++) {
            for (let j = i + 1; j < players.length; j++) {
                // Ida
                await addDoc(collection(db, "partidas"), { p1: players[i], p2: players[j], g1: 0, g2: 0 });
                // Volta
                await addDoc(collection(db, "partidas"), { p1: players[j], p2: players[i], g1: 0, g2: 0 });
            }
        }
        alert("Confrontos gerados!");
    };

    window.updateScore = async (id, p1Nome, p2Nome) => {
        const g1 = parseInt(document.getElementById(`g1-${id}`).value);
        const g2 = parseInt(document.getElementById(`g2-${id}`).value);
        
        // Atualiza partida
        await updateDoc(doc(db, "partidas", id), { g1, g2 });
        
        // L√≥gica de pontos seria disparada aqui para atualizar a collection de jogadores
        // Nota: Em um app real, use Cloud Functions para evitar trapa√ßas no client-side
        alert("Placar atualizado! (N√£o esque√ßa de recalcular a tabela)");
    };

</script>
</body>
</html>
